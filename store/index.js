import Vuex from "vuex";
import axios from "axios";

const homepage =
  'http://test-cms.diwanee.net/graphql/node?query=%7B%0A%20%20nodes(title%3A%20"Homepage")%20%7B%0A%20%20%20%20elements%20%7B%0A%20%20%20%20%20%20type%0A%20%20%20%20%20%20data%0A%20%20%20%20%20%20element_item%20%7B%0A%20%20%20%20%20%20%20%20...%20on%20Nodes%20%7B%0A%20%20%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20%20%20elements%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20type%0A%20%20%20%20%20%20%20%20%20%20%20%20element_item%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20Nodes%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20created_at%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20category%3A%20tags(taxonomy%3A%20"Category")%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20featured_image%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20images%3A%20elements(type%3A%20"image")%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20additional_fields%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20TypeArticle%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20intro%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20element_item%20%7B%0A%20%20%20%20%20%20%20%20...%20on%20NodeLists%20%7B%0A%20%20%20%20%20%20%20%20%20%20name%0A%20%20%20%20%20%20%20%20%20%20list_items%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20%20%20%20%20title%0A%20%20%20%20%20%20%20%20%20%20%20%20category%3A%20tags(taxonomy%3A%20"Category")%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20id%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20featured_image%3A%20elements(type%3A%20"featured_image")%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20images%3A%20elements(type%3A%20"image")%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20data%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20additional_fields%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20...%20on%20TypeArticle%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20intro%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%7D%0A%7D%0A';

const createStore = () => {
  return new Vuex.Store({
    state: {
      loadedNodes: [],
      count: 0,
      scrolled: false
    },
    mutations: {
      setNodes(state, nodes) {
        state.loadedNodes = nodes;
      }
    },
    actions: {
      nuxtServerInit(vuexContext, context) {
        return axios.get(homepage)
          .then(res => {
            const nodesArray = res.data.data.nodes[0].elements;
            vuexContext.commit('setNodes', nodesArray)
          })
          .catch(e => context.error(e));
      },
      setNodes(vuexContext, nodes) {
        vuexContext.commit("setNodes", nodes);
      }
    },
    getters: {
      loadedNodes(state) {
        return state.loadedNodes;
      }
    }
  });
};

export default createStore;
